var Qe=Object.defineProperty;var He=t=>{throw TypeError(t)};var We=(t,e,r)=>e in t?Qe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B=(t,e,r)=>We(t,typeof e!="symbol"?e+"":e,r),Xe=(t,e,r)=>e.has(t)||He("Cannot "+r);var p=(t,e,r)=>(Xe(t,e,"read from private field"),r?r.call(t):e.get(t)),H=(t,e,r)=>e.has(t)?He("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r);import{f as ue,b as Ze,h as S,U as fe,a6 as $e,P as et,t as E,Q as tt,R as rt,T as Ae,V as ce,i as se,ag as at,aJ as st,as as Te,c as z,aO as T,g as ge,s as it,a4 as nt,y as ze,aH as me,aP as ot,aQ as lt,aM as ut,ae as Ne,aR as ft,a as je,p as Ve,aS as de,aT as ct,aG as dt,d as ht,aD as vt,aU as Be,q as Ke,aV as gt,az as pt,aW as _t,aX as mt,aY as yt,aZ as bt,a_ as wt,z as St,a$ as kt,b0 as Ue,aN as Ct,u as Je,r as Ge,b1 as Et,C as M,F as L,D as ie,H as F,I as ne,J as R,M as V,N as Pe}from"./C2Snk8yw.js";import{a as A,f as D,c as Me}from"./DLW7Edu-.js";import{s as pe}from"./DpkvAVPE.js";import{p as oe,i as j}from"./DZ-Qxf6U.js";import{s as Le}from"./CTRDKxTZ.js";function ar(t,e){return e}function It(t,e,r){for(var a=[],s=e.length,i,n=e.length,u=0;u<s;u++){let _=e[u];Ve(_,()=>{if(i){if(i.pending.delete(_),i.done.add(_),i.pending.size===0){var h=t.outrogroups;_e(me(i.done)),h.delete(i),h.size===0&&(t.outrogroups=null)}}else n-=1},!1)}if(n===0){var l=a.length===0&&r!==null;if(l){var c=r,f=c.parentNode;dt(f),f.append(c),t.items.clear()}_e(e,!l)}else i={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(i)}function _e(t,e=!0){for(var r=0;r<t.length;r++)ht(t[r],e)}var Oe;function sr(t,e,r,a,s,i=null){var n=t,u=new Map,l=(e&Be)!==0;if(l){var c=t;n=S?fe($e(c)):c.appendChild(ue())}S&&et();var f=null,_=nt(()=>{var d=r();return ze(d)?d:d==null?[]:me(d)}),h,v=!0;function k(){o.fallback=f,Ht(o,h,n,e,a),f!==null&&(h.length===0?(f.f&T)===0?je(f):(f.f^=T,U(f,null,n)):Ve(f,()=>{f=null}))}var m=Ze(()=>{h=E(_);var d=h.length;let N=!1;if(S){var P=tt(n)===rt;P!==(d===0)&&(n=Ae(),fe(n),ce(!1),N=!0)}for(var g=new Set,y=z,C=it(),b=0;b<d;b+=1){S&&se.nodeType===at&&se.data===st&&(n=se,N=!0,ce(!1));var x=h[b],q=a(x,b),w=v?null:u.get(q);w?(w.v&&Te(w.v,x),w.i&&Te(w.i,b),C&&y.skipped_effects.delete(w.e)):(w=At(u,v?n:Oe??(Oe=ue()),x,q,b,s,e,r),v||(w.e.f|=T),u.set(q,w)),g.add(q)}if(d===0&&i&&!f&&(v?f=ge(()=>i(n)):(f=ge(()=>i(Oe??(Oe=ue()))),f.f|=T)),S&&d>0&&fe(Ae()),!v)if(C){for(const[re,ae]of u)g.has(re)||y.skipped_effects.add(ae.e);y.oncommit(k),y.ondiscard(()=>{})}else k();N&&ce(!0),E(_)}),o={effect:m,items:u,outrogroups:null,fallback:f};v=!1,S&&(n=se)}function K(t){for(;t!==null&&(t.f&ct)===0;)t=t.next;return t}function Ht(t,e,r,a,s){var w,re,ae,be,we,Se,ke,Ce,Ee;var i=(a&gt)!==0,n=e.length,u=t.items,l=K(t.effect.first),c,f=null,_,h=[],v=[],k,m,o,d;if(i)for(d=0;d<n;d+=1)k=e[d],m=s(k,d),o=u.get(m).e,(o.f&T)===0&&((re=(w=o.nodes)==null?void 0:w.a)==null||re.measure(),(_??(_=new Set)).add(o));for(d=0;d<n;d+=1){if(k=e[d],m=s(k,d),o=u.get(m).e,t.outrogroups!==null)for(const I of t.outrogroups)I.pending.delete(o),I.done.delete(o);if((o.f&T)!==0)if(o.f^=T,o===l)U(o,null,r);else{var N=f?f.next:l;o===t.effect.last&&(t.effect.last=o.prev),o.prev&&(o.prev.next=o.next),o.next&&(o.next.prev=o.prev),O(t,f,o),O(t,o,N),U(o,N,r),f=o,h=[],v=[],l=K(f.next);continue}if((o.f&de)!==0&&(je(o),i&&((be=(ae=o.nodes)==null?void 0:ae.a)==null||be.unfix(),(_??(_=new Set)).delete(o))),o!==l){if(c!==void 0&&c.has(o)){if(h.length<v.length){var P=v[0],g;f=P.prev;var y=h[0],C=h[h.length-1];for(g=0;g<h.length;g+=1)U(h[g],P,r);for(g=0;g<v.length;g+=1)c.delete(v[g]);O(t,y.prev,C.next),O(t,f,y),O(t,C,P),l=P,f=C,d-=1,h=[],v=[]}else c.delete(o),U(o,l,r),O(t,o.prev,o.next),O(t,o,f===null?t.effect.first:f.next),O(t,f,o),f=o;continue}for(h=[],v=[];l!==null&&l!==o;)(c??(c=new Set)).add(l),v.push(l),l=K(l.next);if(l===null)continue}(o.f&T)===0&&h.push(o),f=o,l=K(o.next)}if(t.outrogroups!==null){for(const I of t.outrogroups)I.pending.size===0&&(_e(me(I.done)),(we=t.outrogroups)==null||we.delete(I));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||c!==void 0){var b=[];if(c!==void 0)for(o of c)(o.f&de)===0&&b.push(o);for(;l!==null;)(l.f&de)===0&&l!==t.fallback&&b.push(l),l=K(l.next);var x=b.length;if(x>0){var q=(a&Be)!==0&&n===0?r:null;if(i){for(d=0;d<x;d+=1)(ke=(Se=b[d].nodes)==null?void 0:Se.a)==null||ke.measure();for(d=0;d<x;d+=1)(Ee=(Ce=b[d].nodes)==null?void 0:Ce.a)==null||Ee.fix()}It(t,b,q)}}i&&Ke(()=>{var I,Ie;if(_!==void 0)for(o of _)(Ie=(I=o.nodes)==null?void 0:I.a)==null||Ie.apply()})}function At(t,e,r,a,s,i,n,u){var l=(n&ot)!==0?(n&lt)===0?ut(r,!1,!1):Ne(r):null,c=(n&ft)!==0?Ne(s):null;return{v:l,i:c,e:ge(()=>(i(e,l??r,c??s,u),()=>{t.delete(a)}))}}function U(t,e,r){if(t.nodes)for(var a=t.nodes.start,s=t.nodes.end,i=e&&(e.f&T)===0?e.nodes.start:r;a!==null;){var n=vt(a);if(i.before(a),a===s)return;a=n}}function O(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function Ye(t){var e,r,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(r=Ye(t[e]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r);return a}function Tt(){for(var t,e,r=0,a="",s=arguments.length;r<s;r++)(t=arguments[r])&&(e=Ye(t))&&(a&&(a+=" "),a+=e);return a}function ir(t){return typeof t=="object"?Tt(t):t??""}const Fe=[...` 	
\r\fÂ \v\uFEFF`];function Nt(t,e,r){var a=t==null?"":""+t;if(e&&(a=a?a+" "+e:e),r){for(var s in r)if(r[s])a=a?a+" "+s:s;else if(a.length)for(var i=s.length,n=0;(n=a.indexOf(s,n))>=0;){var u=n+i;(n===0||Fe.includes(a[n-1]))&&(u===a.length||Fe.includes(a[u]))?a=(n===0?"":a.substring(0,n))+a.substring(u+1):n=u}}return a===""?null:a}function nr(t,e){return t==null?null:String(t)}function J(t,e,r,a,s,i){var n=t.__className;if(S||n!==r||n===void 0){var u=Nt(r,a,i);(!S||u!==t.getAttribute("class"))&&(u==null?t.removeAttribute("class"):e?t.className=u:t.setAttribute("class",u)),t.__className=r}else if(i&&s!==i)for(var l in i){var c=!!i[l];(s==null||c!==!!s[l])&&t.classList.toggle(l,c)}return i}function Pt(t,e,r=!1){if(t.multiple){if(e==null)return;if(!ze(e))return _t();for(var a of t.options)a.selected=e.includes(Re(a));return}for(a of t.options){var s=Re(a);if(mt(s,e)){a.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function or(t){var e=new MutationObserver(()=>{Pt(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),pt(()=>{e.disconnect()})}function Re(t){return"__value"in t?t.__value:t.value}const Mt=Symbol("is custom element"),Lt=Symbol("is html");function lr(t){if(S){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var a=t.value;xe(t,"value",null),t.value=a}if(t.hasAttribute("checked")){var s=t.checked;xe(t,"checked",null),t.checked=s}}};t.__on_r=r,Ke(r),yt()}}function ur(t,e){var r=ye(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function fr(t,e){var r=ye(t);r.checked!==(r.checked=e??void 0)&&(t.checked=e)}function xe(t,e,r,a){var s=ye(t);S&&(s[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||s[e]!==(s[e]=r)&&(e==="loading"&&(t[bt]=r),r==null?t.removeAttribute(e):typeof r!="string"&&Ot(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function ye(t){return t.__attributes??(t.__attributes={[Mt]:t.nodeName.includes("-"),[Lt]:t.namespaceURI===wt})}var De=new Map;function Ot(t){var e=t.getAttribute("is")||t.nodeName,r=De.get(e);if(r)return r;De.set(e,r=[]);for(var a,s=t,i=Element.prototype;i!==s;){a=kt(s);for(var n in a)a[n].set&&r.push(n);s=St(s)}return r}function cr(t,e,r=e){var a=new WeakSet;Ue(t,"input",async s=>{var i=s?t.defaultValue:t.value;if(i=he(t)?ve(i):i,r(i),z!==null&&a.add(z),await Ct(),i!==(i=e())){var n=t.selectionStart,u=t.selectionEnd,l=t.value.length;if(t.value=i??"",u!==null){var c=t.value.length;n===u&&u===l&&c>l?(t.selectionStart=c,t.selectionEnd=c):(t.selectionStart=n,t.selectionEnd=Math.min(u,c))}}}),(S&&t.defaultValue!==t.value||Je(e)==null&&t.value)&&(r(he(t)?ve(t.value):t.value),z!==null&&a.add(z)),Ge(()=>{var s=e();if(t===document.activeElement){var i=Et??z;if(a.has(i))return}he(t)&&s===ve(t.value)||t.type==="date"&&!s&&!t.value||s!==t.value&&(t.value=s??"")})}function dr(t,e,r=e){Ue(t,"change",a=>{var s=a?t.defaultChecked:t.checked;r(s)}),(S&&t.defaultChecked!==t.checked||Je(e)==null)&&r(t.checked),Ge(()=>{var a=e();t.checked=!!a})}function he(t){var e=t.type;return e==="number"||e==="range"}function ve(t){return t===""?null:+t}function te(){return localStorage.getItem("mahoraga_backend_url")||"/agent"}function Ft(){var t,e;return((t=localStorage.getItem("mahoraga_api_token"))==null?void 0:t.trim())||((e=window.VITE_MAHORAGA_API_TOKEN)==null?void 0:e.trim())||""}function le(t,e={}){const r=Ft(),a=new Headers(e.headers);return r&&a.set("Authorization",`Bearer ${r}`),!a.has("Content-Type")&&e.body&&a.set("Content-Type","application/json"),fetch(t,{...e,headers:a})}async function Rt(t){try{const r=await(await le(t)).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Request failed"}}catch{return{data:null,error:"Connection failed"}}}async function xt(){try{const e=await(await le(`${te()}/status`)).json();return e.ok?{data:e.data,error:null}:{data:null,error:e.error||"Failed to fetch status"}}catch{return{data:null,error:"Connection failed - is the agent running?"}}}async function Dt(){try{const e=await(await le(`${te()}/setup/status`)).json();return e.ok?{data:e.data,error:null}:{data:null,error:e.error||"Failed to check setup"}}catch{return{data:null,error:"Connection failed"}}}async function qt(t){try{const r=await(await le(`${te()}/config`,{method:"POST",body:JSON.stringify(t)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save config"}}catch{return{data:null,error:"Connection failed"}}}async function hr(t){try{const r=await(await fetch(`${te()}/setup/keys`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save configuration"}}catch{return{data:null,error:"Failed to connect to agent"}}}async function zt(t=1e3){return Rt(`${te()}/logs?limit=${t}`)}function jt(t,e=24){const r=[],a=Date.now(),s=36e5;let i=t*.95;for(let n=e;n>=0;n--){const u=(Math.random()-.45)*t*.005;i=Math.max(i+u,t*.8);const l=i-t*.95;r.push({timestamp:a-n*s,equity:i,pl:l,pl_pct:l/(t*.95)*100})}return r[r.length-1]={timestamp:a,equity:t,pl:t-r[0].equity,pl_pct:(t-r[0].equity)/r[0].equity*100},r}function Vt(t,e,r=20){const a=[],s=e>=0,i=t*(s?.95:1.05);for(let n=0;n<r;n++){const u=n/(r-1),l=i+(t-i)*u,c=l*(Math.random()-.5)*.02;a.push(l+c)}return a[a.length-1]=t,a}const qe=["cyan","purple","yellow","blue","green"];var G,Y,Q,W,X,Z,$,ee;class Bt{constructor(){H(this,G,M(null));H(this,Y,M(null));H(this,Q,M(!1));H(this,W,M(!1));H(this,X,M(ie(new Date)));H(this,Z,M(ie([])));H(this,$,M(ie([])));H(this,ee,M(ie({})));B(this,"pollInterval",null);B(this,"timeInterval",null);B(this,"priceHistoryCache",{});B(this,"priceHistoryCacheKey","")}get status(){return E(p(this,G))}set status(e){L(p(this,G),e,!0)}get error(){return E(p(this,Y))}set error(e){L(p(this,Y),e,!0)}get showSetup(){return E(p(this,Q))}set showSetup(e){L(p(this,Q),e,!0)}get setupChecked(){return E(p(this,W))}set setupChecked(e){L(p(this,W),e,!0)}get time(){return E(p(this,X))}set time(e){L(p(this,X),e,!0)}get portfolioHistory(){return E(p(this,Z))}set portfolioHistory(e){L(p(this,Z),e,!0)}get fullLogs(){return E(p(this,$))}set fullLogs(e){L(p(this,$),e,!0)}get logFilters(){return E(p(this,ee))}set logFilters(e){L(p(this,ee),e,!0)}get account(){var e;return((e=this.status)==null?void 0:e.account)??null}get positions(){var e;return((e=this.status)==null?void 0:e.positions)??[]}get signals(){var e;return((e=this.status)==null?void 0:e.signals)??[]}get logs(){var e;return((e=this.status)==null?void 0:e.logs)??[]}get costs(){var e;return((e=this.status)==null?void 0:e.costs)??{total_usd:0,calls:0,tokens_in:0,tokens_out:0}}get config(){var e;return((e=this.status)==null?void 0:e.config)??null}get isMarketOpen(){var e,r,a;return(e=this.config)!=null&&e.crypto_enabled?!0:((a=(r=this.status)==null?void 0:r.clock)==null?void 0:a.is_open)??!1}get startingEquity(){var e;return((e=this.config)==null?void 0:e.starting_equity)||1e5}get unrealizedPl(){return this.positions.reduce((e,r)=>e+r.unrealized_pl,0)}get totalPl(){return this.account?this.account.equity-this.startingEquity:0}get realizedPl(){return this.totalPl-this.unrealizedPl}get totalPlPct(){return this.account?this.totalPl/this.startingEquity*100:0}get portfolioChartData(){return this.portfolioHistory.map(e=>e.equity)}get portfolioChartLabels(){return this.portfolioHistory.map(e=>new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}))}get positionPriceHistories(){const e=this.positions.map(r=>r.symbol).join(",");if(this.priceHistoryCacheKey!==e){const r={};for(const a of this.positions)r[a.symbol]=Vt(a.current_price,a.unrealized_pl);this.priceHistoryCache=r,this.priceHistoryCacheKey=e}return this.priceHistoryCache}get normalizedPositionSeries(){return this.positions.slice(0,5).map((e,r)=>{const a=this.positionPriceHistories[e.symbol]||[];if(a.length<2)return null;const s=a[0],i=a.map(n=>(n-s)/s*100);return{label:e.symbol,data:i,variant:qe[r%qe.length]}}).filter(e=>e!==null)}get filteredLogs(){return this.fullLogs.filter(e=>{var r;return!(this.logFilters.agent&&e.agent!==this.logFilters.agent||this.logFilters.action&&e.action!==this.logFilters.action||this.logFilters.symbol&&!((r=e.symbol)!=null&&r.toLowerCase().includes(this.logFilters.symbol.toLowerCase())))})}async checkSetup(){const{data:e}=await Dt();e&&!e.configured&&(this.showSetup=!0),this.setupChecked=!0}async poll(){const{data:e,error:r}=await xt();e?(this.status=e,this.error=null,this.updatePortfolioHistory(e)):r&&(this.error=r)}async fetchFullLogs(e=1e3){const{data:r}=await zt(e);r&&(this.fullLogs=r.logs)}updatePortfolioHistory(e){var s;if(!e.account)return;if(this.portfolioHistory.length===0){this.portfolioHistory=jt(e.account.equity);return}const a={timestamp:Date.now(),equity:e.account.equity,pl:e.account.equity-(((s=this.portfolioHistory[0])==null?void 0:s.equity)||e.account.equity),pl_pct:this.portfolioHistory[0]?(e.account.equity-this.portfolioHistory[0].equity)/this.portfolioHistory[0].equity*100:0};this.portfolioHistory=[...this.portfolioHistory,a].slice(-48)}startPolling(){this.pollInterval||(this.poll(),this.pollInterval=setInterval(()=>this.poll(),5e3),this.timeInterval=setInterval(()=>this.time=new Date,1e3))}stopPolling(){this.pollInterval&&clearInterval(this.pollInterval),this.timeInterval&&clearInterval(this.timeInterval),this.pollInterval=null,this.timeInterval=null}async handleSaveConfig(e){const{data:r}=await qt(e);r&&this.status&&(this.status={...this.status,config:r})}completeSetup(){this.showSetup=!1}}G=new WeakMap,Y=new WeakMap,Q=new WeakMap,W=new WeakMap,X=new WeakMap,Z=new WeakMap,$=new WeakMap,ee=new WeakMap;const vr=new Bt;var Kt=D("<div></div>"),Ut=D('<span class="hud-label"> </span>'),Jt=D('<div><div class="relative"><div></div> <!></div> <!></div>');function gr(t,e){const r={active:"bg-hud-success",warning:"bg-hud-warning",error:"bg-hud-error",inactive:"bg-hud-dim"};let a=oe(e,"pulse",3,!1),s=oe(e,"class",3,"");var i=Jt(),n=F(i),u=F(n),l=ne(u,2);{var c=h=>{var v=Kt();V(()=>J(v,1,`absolute inset-0 w-2 h-2 rounded-full animate-ping ${r[e.status]??""} opacity-75`)),A(h,v)};j(l,h=>{a()&&e.status==="active"&&h(c)})}R(n);var f=ne(n,2);{var _=h=>{var v=Ut(),k=F(v,!0);R(v),V(()=>pe(k,e.label)),A(h,v)};j(f,h=>{e.label&&h(_)})}R(i),V(()=>{J(i,1,`flex items-center gap-2 ${s()??""}`),J(u,1,`w-2 h-2 rounded-full ${r[e.status]??""}`)}),A(t,i)}var Gt=D('<span class="hud-label"> </span>'),Yt=D('<span class="hud-value-sm"> </span>'),Qt=D('<div class="flex justify-between items-center px-4 py-2 border-b border-hud-line shrink-0"><!> <!></div>'),Wt=D("<div><!> <div><!></div></div>");function pr(t,e){let r=oe(e,"class",3,""),a=oe(e,"noPadding",3,!1);var s=Wt(),i=F(s);{var n=c=>{var f=Qt(),_=F(f);{var h=m=>{var o=Gt(),d=F(o,!0);R(o),V(()=>pe(d,e.title)),A(m,o)};j(_,m=>{e.title&&m(h)})}var v=ne(_,2);{var k=m=>{var o=Me(),d=Pe(o);{var N=g=>{var y=Yt(),C=F(y,!0);R(y),V(()=>pe(C,e.titleRight)),A(g,y)},P=g=>{var y=Me(),C=Pe(y);Le(C,()=>e.titleRight),A(g,y)};j(d,g=>{typeof e.titleRight=="string"?g(N):g(P,!1)})}A(m,o)};j(v,m=>{e.titleRight&&m(k)})}R(f),A(c,f)};j(i,c=>{(e.title||e.titleRight)&&c(n)})}var u=ne(i,2),l=F(u);Le(l,()=>e.children),R(u),R(s),V(()=>{J(s,1,`hud-panel flex flex-col ${r()??""}`),J(u,1,`flex-1 min-h-0 ${a()?"":"p-3"}`)}),A(t,s)}export{pr as P,gr as S,ur as a,cr as b,or as c,vr as d,sr as e,Pt as f,fr as g,ir as h,ar as i,xe as j,dr as k,hr as l,lr as r,J as s,nr as t};
