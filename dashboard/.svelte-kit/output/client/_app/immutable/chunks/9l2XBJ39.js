var Ke=Object.defineProperty;var Ee=e=>{throw TypeError(e)};var Ue=(e,t,r)=>t in e?Ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var V=(e,t,r)=>Ue(e,typeof t!="symbol"?t+"":t,r),Ye=(e,t,r)=>t.has(e)||Ee("Cannot "+r);var b=(e,t,r)=>(Ye(e,t,"read from private field"),r?r.call(e):t.get(e)),R=(e,t,r)=>t.has(e)?Ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r);import{f as ie,b as Ge,h as k,X as ne,a9 as Je,T as We,t as P,U as Xe,V as Qe,W as Ie,Y as oe,i as te,aj as Ze,aL as $e,av as Ce,c as z,aQ as H,g as ce,s as et,a7 as tt,H as rt,aJ as ve,aR as at,aS as st,aO as it,ah as He,aT as nt,a as De,p as qe,aU as le,aV as ot,aI as lt,d as ut,aF as ft,aW as Fe,q as Le,aX as ct,aY as dt,aZ as ht,a_ as vt,I as gt,a$ as pt,b0 as ze,aP as _t,u as je,r as Be,b1 as yt,N as F,P as L,O as Ae,D as O,G as re,F as M,B,z as Te}from"./BMldKSzV.js";import{a as C,f as D,c as Ne}from"./Dvq9GajI.js";import{s as de}from"./BS5HiHz8.js";import{p as ae,i as j}from"./CobWLHRY.js";import{s as Pe}from"./DpuPE-1g.js";function Gt(e,t){return t}function mt(e,t,r){for(var a=[],i=t.length,n,o=t.length,f=0;f<i;f++){let p=t[f];qe(p,()=>{if(n){if(n.pending.delete(p),n.done.add(p),n.pending.size===0){var h=e.outrogroups;he(ve(n.done)),h.delete(n),h.size===0&&(e.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=a.length===0&&r!==null;if(l){var d=r,u=d.parentNode;lt(u),u.append(d),e.items.clear()}he(t,!l)}else n={pending:new Set(t),done:new Set},(e.outrogroups??(e.outrogroups=new Set)).add(n)}function he(e,t=!0){for(var r=0;r<e.length;r++)ut(e[r],t)}var Oe;function Jt(e,t,r,a,i,n=null){var o=e,f=new Map,l=(t&Fe)!==0;if(l){var d=e;o=k?ne(Je(d)):d.appendChild(ie())}k&&We();var u=null,p=tt(()=>{var c=r();return rt(c)?c:c==null?[]:ve(c)}),h,v=!0;function w(){s.fallback=u,bt(s,h,o,t,a),u!==null&&(h.length===0?(u.f&H)===0?De(u):(u.f^=H,U(u,null,o)):qe(u,()=>{u=null}))}var _=Ge(()=>{h=P(p);var c=h.length;let A=!1;if(k){var T=Xe(o)===Qe;T!==(c===0)&&(o=Ie(),ne(o),oe(!1),A=!0)}for(var g=new Set,y=z,E=et(),m=0;m<c;m+=1){k&&te.nodeType===Ze&&te.data===$e&&(o=te,A=!0,oe(!1));var x=h[m],q=a(x,m),S=v?null:f.get(q);S?(S.v&&Ce(S.v,x),S.i&&Ce(S.i,m),E&&y.skipped_effects.delete(S.e)):(S=St(f,v?o:Oe??(Oe=ie()),x,q,m,i,t,r),v||(S.e.f|=H),f.set(q,S)),g.add(q)}if(c===0&&n&&!u&&(v?u=ce(()=>n(o)):(u=ce(()=>n(Oe??(Oe=ie()))),u.f|=H)),k&&c>0&&ne(Ie()),!v)if(E){for(const[$,ee]of f)g.has($)||y.skipped_effects.add(ee.e);y.oncommit(w),y.ondiscard(()=>{})}else w();A&&oe(!0),P(p)}),s={effect:_,items:f,outrogroups:null,fallback:u};v=!1,k&&(o=te)}function K(e){for(;e!==null&&(e.f&ot)===0;)e=e.next;return e}function bt(e,t,r,a,i){var S,$,ee,_e,ye,me,be,Se,ke;var n=(a&ct)!==0,o=t.length,f=e.items,l=K(e.effect.first),d,u=null,p,h=[],v=[],w,_,s,c;if(n)for(c=0;c<o;c+=1)w=t[c],_=i(w,c),s=f.get(_).e,(s.f&H)===0&&(($=(S=s.nodes)==null?void 0:S.a)==null||$.measure(),(p??(p=new Set)).add(s));for(c=0;c<o;c+=1){if(w=t[c],_=i(w,c),s=f.get(_).e,e.outrogroups!==null)for(const I of e.outrogroups)I.pending.delete(s),I.done.delete(s);if((s.f&H)!==0)if(s.f^=H,s===l)U(s,null,r);else{var A=u?u.next:l;s===e.effect.last&&(e.effect.last=s.prev),s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),N(e,u,s),N(e,s,A),U(s,A,r),u=s,h=[],v=[],l=K(u.next);continue}if((s.f&le)!==0&&(De(s),n&&((_e=(ee=s.nodes)==null?void 0:ee.a)==null||_e.unfix(),(p??(p=new Set)).delete(s))),s!==l){if(d!==void 0&&d.has(s)){if(h.length<v.length){var T=v[0],g;u=T.prev;var y=h[0],E=h[h.length-1];for(g=0;g<h.length;g+=1)U(h[g],T,r);for(g=0;g<v.length;g+=1)d.delete(v[g]);N(e,y.prev,E.next),N(e,u,y),N(e,E,T),l=T,u=E,c-=1,h=[],v=[]}else d.delete(s),U(s,l,r),N(e,s.prev,s.next),N(e,s,u===null?e.effect.first:u.next),N(e,u,s),u=s;continue}for(h=[],v=[];l!==null&&l!==s;)(d??(d=new Set)).add(l),v.push(l),l=K(l.next);if(l===null)continue}(s.f&H)===0&&h.push(s),u=s,l=K(s.next)}if(e.outrogroups!==null){for(const I of e.outrogroups)I.pending.size===0&&(he(ve(I.done)),(ye=e.outrogroups)==null||ye.delete(I));e.outrogroups.size===0&&(e.outrogroups=null)}if(l!==null||d!==void 0){var m=[];if(d!==void 0)for(s of d)(s.f&le)===0&&m.push(s);for(;l!==null;)(l.f&le)===0&&l!==e.fallback&&m.push(l),l=K(l.next);var x=m.length;if(x>0){var q=(a&Fe)!==0&&o===0?r:null;if(n){for(c=0;c<x;c+=1)(be=(me=m[c].nodes)==null?void 0:me.a)==null||be.measure();for(c=0;c<x;c+=1)(ke=(Se=m[c].nodes)==null?void 0:Se.a)==null||ke.fix()}mt(e,m,q)}}n&&Le(()=>{var I,we;if(p!==void 0)for(s of p)(we=(I=s.nodes)==null?void 0:I.a)==null||we.apply()})}function St(e,t,r,a,i,n,o,f){var l=(o&at)!==0?(o&st)===0?it(r,!1,!1):He(r):null,d=(o&nt)!==0?He(i):null;return{v:l,i:d,e:ce(()=>(n(t,l??r,d??i,f),()=>{e.delete(a)}))}}function U(e,t,r){if(e.nodes)for(var a=e.nodes.start,i=e.nodes.end,n=t&&(t.f&H)===0?t.nodes.start:r;a!==null;){var o=ft(a);if(n.before(a),a===i)return;a=o}}function N(e,t,r){t===null?e.effect.first=r:t.next=r,r===null?e.effect.last=t:r.prev=t}function Ve(e){var t,r,a="";if(typeof e=="string"||typeof e=="number")a+=e;else if(typeof e=="object")if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(r=Ve(e[t]))&&(a&&(a+=" "),a+=r)}else for(r in e)e[r]&&(a&&(a+=" "),a+=r);return a}function kt(){for(var e,t,r=0,a="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=Ve(e))&&(a&&(a+=" "),a+=t);return a}function Wt(e){return typeof e=="object"?kt(e):e??""}function wt(e,t,r){var a=e==null?"":""+e;return a===""?null:a}function Xt(e,t){return e==null?null:String(e)}function Y(e,t,r,a,i,n){var o=e.__className;if(k||o!==r||o===void 0){var f=wt(r);(!k||f!==e.getAttribute("class"))&&(f==null?e.removeAttribute("class"):t?e.className=f:e.setAttribute("class",f)),e.__className=r}return n}const Et=Symbol("is custom element"),It=Symbol("is html");function Qt(e){if(k){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var a=e.value;Me(e,"value",null),e.value=a}if(e.hasAttribute("checked")){var i=e.checked;Me(e,"checked",null),e.checked=i}}};e.__on_r=r,Le(r),dt()}}function Zt(e,t){var r=ge(e);r.value===(r.value=t??void 0)||e.value===t&&(t!==0||e.nodeName!=="PROGRESS")||(e.value=t??"")}function $t(e,t){var r=ge(e);r.checked!==(r.checked=t??void 0)&&(e.checked=t)}function Me(e,t,r,a){var i=ge(e);k&&(i[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||i[t]!==(i[t]=r)&&(t==="loading"&&(e[ht]=r),r==null?e.removeAttribute(t):typeof r!="string"&&Ct(e).includes(t)?e[t]=r:e.setAttribute(t,r))}function ge(e){return e.__attributes??(e.__attributes={[Et]:e.nodeName.includes("-"),[It]:e.namespaceURI===vt})}var xe=new Map;function Ct(e){var t=e.getAttribute("is")||e.nodeName,r=xe.get(t);if(r)return r;xe.set(t,r=[]);for(var a,i=e,n=Element.prototype;n!==i;){a=pt(i);for(var o in a)a[o].set&&r.push(o);i=gt(i)}return r}function er(e,t,r=t){var a=new WeakSet;ze(e,"input",async i=>{var n=i?e.defaultValue:e.value;if(n=ue(e)?fe(n):n,r(n),z!==null&&a.add(z),await _t(),n!==(n=t())){var o=e.selectionStart,f=e.selectionEnd,l=e.value.length;if(e.value=n??"",f!==null){var d=e.value.length;o===f&&f===l&&d>l?(e.selectionStart=d,e.selectionEnd=d):(e.selectionStart=o,e.selectionEnd=Math.min(f,d))}}}),(k&&e.defaultValue!==e.value||je(t)==null&&e.value)&&(r(ue(e)?fe(e.value):e.value),z!==null&&a.add(z)),Be(()=>{var i=t();if(e===document.activeElement){var n=yt??z;if(a.has(n))return}ue(e)&&i===fe(e.value)||e.type==="date"&&!i&&!e.value||i!==e.value&&(e.value=i??"")})}function tr(e,t,r=t){ze(e,"change",a=>{var i=a?e.defaultChecked:e.checked;r(i)}),(k&&e.defaultChecked!==e.checked||je(t)==null)&&r(e.checked),Be(()=>{var a=t();e.checked=!!a})}function ue(e){var t=e.type;return t==="number"||t==="range"}function fe(e){return e===""?null:+e}function se(){return localStorage.getItem("mahoraga_backend_url")||"/agent"}function Ht(){var e,t;return((e=localStorage.getItem("mahoraga_api_token"))==null?void 0:e.trim())||((t=window.VITE_MAHORAGA_API_TOKEN)==null?void 0:t.trim())||""}function pe(e,t={}){const r=Ht(),a=new Headers(t.headers);return r&&a.set("Authorization",`Bearer ${r}`),!a.has("Content-Type")&&t.body&&a.set("Content-Type","application/json"),fetch(e,{...t,headers:a})}async function At(){try{const t=await(await pe(`${se()}/status`)).json();return t.ok?{data:t.data,error:null}:{data:null,error:t.error||"Failed to fetch status"}}catch{return{data:null,error:"Connection failed - is the agent running?"}}}async function Tt(){try{const t=await(await pe(`${se()}/setup/status`)).json();return t.ok?{data:t.data,error:null}:{data:null,error:t.error||"Failed to check setup"}}catch{return{data:null,error:"Connection failed"}}}async function Nt(e){try{const r=await(await pe(`${se()}/config`,{method:"POST",body:JSON.stringify(e)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save config"}}catch{return{data:null,error:"Connection failed"}}}async function rr(e){try{const r=await(await fetch(`${se()}/setup/keys`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save configuration"}}catch{return{data:null,error:"Failed to connect to agent"}}}function Pt(e,t=24){const r=[],a=Date.now(),i=36e5;let n=e*.95;for(let o=t;o>=0;o--){const f=(Math.random()-.45)*e*.005;n=Math.max(n+f,e*.8);const l=n-e*.95;r.push({timestamp:a-o*i,equity:n,pl:l,pl_pct:l/(e*.95)*100})}return r[r.length-1]={timestamp:a,equity:e,pl:e-r[0].equity,pl_pct:(e-r[0].equity)/r[0].equity*100},r}function Ot(e,t,r=20){const a=[],i=t>=0,n=e*(i?.95:1.05);for(let o=0;o<r;o++){const f=o/(r-1),l=n+(e-n)*f,d=l*(Math.random()-.5)*.02;a.push(l+d)}return a[a.length-1]=e,a}const Re=["cyan","purple","yellow","blue","green"];var G,J,W,X,Q,Z;class Mt{constructor(){R(this,G,F(null));R(this,J,F(null));R(this,W,F(!1));R(this,X,F(!1));R(this,Q,F(Ae(new Date)));R(this,Z,F(Ae([])));V(this,"pollInterval",null);V(this,"timeInterval",null);V(this,"priceHistoryCache",{});V(this,"priceHistoryCacheKey","")}get status(){return P(b(this,G))}set status(t){L(b(this,G),t,!0)}get error(){return P(b(this,J))}set error(t){L(b(this,J),t,!0)}get showSetup(){return P(b(this,W))}set showSetup(t){L(b(this,W),t,!0)}get setupChecked(){return P(b(this,X))}set setupChecked(t){L(b(this,X),t,!0)}get time(){return P(b(this,Q))}set time(t){L(b(this,Q),t,!0)}get portfolioHistory(){return P(b(this,Z))}set portfolioHistory(t){L(b(this,Z),t,!0)}get account(){var t;return((t=this.status)==null?void 0:t.account)??null}get positions(){var t;return((t=this.status)==null?void 0:t.positions)??[]}get signals(){var t;return((t=this.status)==null?void 0:t.signals)??[]}get logs(){var t;return((t=this.status)==null?void 0:t.logs)??[]}get costs(){var t;return((t=this.status)==null?void 0:t.costs)??{total_usd:0,calls:0,tokens_in:0,tokens_out:0}}get config(){var t;return((t=this.status)==null?void 0:t.config)??null}get isMarketOpen(){var t,r,a;return(t=this.config)!=null&&t.crypto_enabled?!0:((a=(r=this.status)==null?void 0:r.clock)==null?void 0:a.is_open)??!1}get startingEquity(){var t;return((t=this.config)==null?void 0:t.starting_equity)||1e5}get unrealizedPl(){return this.positions.reduce((t,r)=>t+r.unrealized_pl,0)}get totalPl(){return this.account?this.account.equity-this.startingEquity:0}get realizedPl(){return this.totalPl-this.unrealizedPl}get totalPlPct(){return this.account?this.totalPl/this.startingEquity*100:0}get portfolioChartData(){return this.portfolioHistory.map(t=>t.equity)}get portfolioChartLabels(){return this.portfolioHistory.map(t=>new Date(t.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}))}get positionPriceHistories(){const t=this.positions.map(r=>r.symbol).join(",");if(this.priceHistoryCacheKey!==t){const r={};for(const a of this.positions)r[a.symbol]=Ot(a.current_price,a.unrealized_pl);this.priceHistoryCache=r,this.priceHistoryCacheKey=t}return this.priceHistoryCache}get normalizedPositionSeries(){return this.positions.slice(0,5).map((t,r)=>{const a=this.positionPriceHistories[t.symbol]||[];if(a.length<2)return null;const i=a[0],n=a.map(o=>(o-i)/i*100);return{label:t.symbol,data:n,variant:Re[r%Re.length]}}).filter(t=>t!==null)}async checkSetup(){const{data:t}=await Tt();t&&!t.configured&&(this.showSetup=!0),this.setupChecked=!0}async poll(){const{data:t,error:r}=await At();t?(this.status=t,this.error=null,this.updatePortfolioHistory(t)):r&&(this.error=r)}updatePortfolioHistory(t){var i;if(!t.account)return;if(this.portfolioHistory.length===0){this.portfolioHistory=Pt(t.account.equity);return}const a={timestamp:Date.now(),equity:t.account.equity,pl:t.account.equity-(((i=this.portfolioHistory[0])==null?void 0:i.equity)||t.account.equity),pl_pct:this.portfolioHistory[0]?(t.account.equity-this.portfolioHistory[0].equity)/this.portfolioHistory[0].equity*100:0};this.portfolioHistory=[...this.portfolioHistory,a].slice(-48)}startPolling(){this.pollInterval||(this.poll(),this.pollInterval=setInterval(()=>this.poll(),5e3),this.timeInterval=setInterval(()=>this.time=new Date,1e3))}stopPolling(){this.pollInterval&&clearInterval(this.pollInterval),this.timeInterval&&clearInterval(this.timeInterval),this.pollInterval=null,this.timeInterval=null}async handleSaveConfig(t){const{data:r}=await Nt(t);r&&this.status&&(this.status={...this.status,config:r})}completeSetup(){this.showSetup=!1}}G=new WeakMap,J=new WeakMap,W=new WeakMap,X=new WeakMap,Q=new WeakMap,Z=new WeakMap;const ar=new Mt;var xt=D("<div></div>"),Rt=D('<span class="hud-label"> </span>'),Dt=D('<div><div class="relative"><div></div> <!></div> <!></div>');function sr(e,t){const r={active:"bg-hud-success",warning:"bg-hud-warning",error:"bg-hud-error",inactive:"bg-hud-dim"};let a=ae(t,"pulse",3,!1),i=ae(t,"class",3,"");var n=Dt(),o=O(n),f=O(o),l=re(f,2);{var d=h=>{var v=xt();B(()=>Y(v,1,`absolute inset-0 w-2 h-2 rounded-full animate-ping ${r[t.status]??""} opacity-75`)),C(h,v)};j(l,h=>{a()&&t.status==="active"&&h(d)})}M(o);var u=re(o,2);{var p=h=>{var v=Rt(),w=O(v,!0);M(v),B(()=>de(w,t.label)),C(h,v)};j(u,h=>{t.label&&h(p)})}M(n),B(()=>{Y(n,1,`flex items-center gap-2 ${i()??""}`),Y(f,1,`w-2 h-2 rounded-full ${r[t.status]??""}`)}),C(e,n)}var qt=D('<span class="hud-label"> </span>'),Ft=D('<span class="hud-value-sm"> </span>'),Lt=D('<div class="flex justify-between items-center px-4 py-2 border-b border-hud-line shrink-0"><!> <!></div>'),zt=D("<div><!> <div><!></div></div>");function ir(e,t){let r=ae(t,"class",3,""),a=ae(t,"noPadding",3,!1);var i=zt(),n=O(i);{var o=d=>{var u=Lt(),p=O(u);{var h=_=>{var s=qt(),c=O(s,!0);M(s),B(()=>de(c,t.title)),C(_,s)};j(p,_=>{t.title&&_(h)})}var v=re(p,2);{var w=_=>{var s=Ne(),c=Te(s);{var A=g=>{var y=Ft(),E=O(y,!0);M(y),B(()=>de(E,t.titleRight)),C(g,y)},T=g=>{var y=Ne(),E=Te(y);Pe(E,()=>t.titleRight),C(g,y)};j(c,g=>{typeof t.titleRight=="string"?g(A):g(T,!1)})}C(_,s)};j(v,_=>{t.titleRight&&_(w)})}M(u),C(d,u)};j(n,d=>{(t.title||t.titleRight)&&d(o)})}var f=re(n,2),l=O(f);Pe(l,()=>t.children),M(f),M(i),B(()=>{Y(i,1,`hud-panel flex flex-col ${r()??""}`),Y(f,1,`flex-1 min-h-0 ${a()?"":"p-3"}`)}),C(e,i)}export{ir as P,sr as S,Zt as a,er as b,$t as c,ar as d,Jt as e,Wt as f,Me as g,tr as h,Gt as i,rr as j,Qt as r,Y as s,Xt as t};
