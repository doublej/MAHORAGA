var Ye=Object.defineProperty;var He=t=>{throw TypeError(t)};var Qe=(t,e,r)=>e in t?Ye(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var B=(t,e,r)=>Qe(t,typeof e!="symbol"?e+"":e,r),We=(t,e,r)=>e.has(t)||He("Cannot "+r);var _=(t,e,r)=>(We(t,e,"read from private field"),r?r.call(t):e.get(t)),H=(t,e,r)=>e.has(t)?He("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r);import{f as ue,b as Xe,h as S,U as fe,a6 as Ze,P as $e,t as E,Q as et,R as tt,T as Ae,V as ce,i as se,ag as rt,aJ as at,as as Te,c as z,aO as T,g as ge,s as st,a4 as it,y as qe,aH as ye,aP as nt,aQ as ot,aM as lt,ae as Ne,aR as ut,a as ze,p as je,aS as de,aT as ft,aG as ct,d as dt,aD as ht,aU as Ve,q as Be,aV as vt,az as gt,aW as _t,aX as pt,aY as yt,aZ as mt,a_ as bt,z as wt,a$ as St,b0 as Ke,aN as kt,u as Ue,r as Je,b1 as Ct,C as M,F,D as ie,H as O,I as ne,J as x,M as V,N as Pe}from"./C2Snk8yw.js";import{a as A,f as D,c as Me}from"./DLW7Edu-.js";import{s as _e}from"./DpkvAVPE.js";import{p as oe,i as j}from"./DZ-Qxf6U.js";import{s as Fe}from"./CTRDKxTZ.js";function rr(t,e){return e}function Et(t,e,r){for(var a=[],i=e.length,n,o=e.length,f=0;f<i;f++){let p=e[f];je(p,()=>{if(n){if(n.pending.delete(p),n.done.add(p),n.pending.size===0){var h=t.outrogroups;pe(ye(n.done)),h.delete(n),h.size===0&&(t.outrogroups=null)}}else o-=1},!1)}if(o===0){var l=a.length===0&&r!==null;if(l){var d=r,u=d.parentNode;ct(u),u.append(d),t.items.clear()}pe(e,!l)}else n={pending:new Set(e),done:new Set},(t.outrogroups??(t.outrogroups=new Set)).add(n)}function pe(t,e=!0){for(var r=0;r<t.length;r++)dt(t[r],e)}var Le;function ar(t,e,r,a,i,n=null){var o=t,f=new Map,l=(e&Ve)!==0;if(l){var d=t;o=S?fe(Ze(d)):d.appendChild(ue())}S&&$e();var u=null,p=it(()=>{var c=r();return qe(c)?c:c==null?[]:ye(c)}),h,v=!0;function k(){s.fallback=u,It(s,h,o,e,a),u!==null&&(h.length===0?(u.f&T)===0?ze(u):(u.f^=T,U(u,null,o)):je(u,()=>{u=null}))}var y=Xe(()=>{h=E(p);var c=h.length;let N=!1;if(S){var P=et(o)===tt;P!==(c===0)&&(o=Ae(),fe(o),ce(!1),N=!0)}for(var g=new Set,m=z,C=st(),b=0;b<c;b+=1){S&&se.nodeType===rt&&se.data===at&&(o=se,N=!0,ce(!1));var R=h[b],q=a(R,b),w=v?null:f.get(q);w?(w.v&&Te(w.v,R),w.i&&Te(w.i,b),C&&m.skipped_effects.delete(w.e)):(w=Ht(f,v?o:Le??(Le=ue()),R,q,b,i,e,r),v||(w.e.f|=T),f.set(q,w)),g.add(q)}if(c===0&&n&&!u&&(v?u=ge(()=>n(o)):(u=ge(()=>n(Le??(Le=ue()))),u.f|=T)),S&&c>0&&fe(Ae()),!v)if(C){for(const[re,ae]of f)g.has(re)||m.skipped_effects.add(ae.e);m.oncommit(k),m.ondiscard(()=>{})}else k();N&&ce(!0),E(p)}),s={effect:y,items:f,outrogroups:null,fallback:u};v=!1,S&&(o=se)}function K(t){for(;t!==null&&(t.f&ft)===0;)t=t.next;return t}function It(t,e,r,a,i){var w,re,ae,be,we,Se,ke,Ce,Ee;var n=(a&vt)!==0,o=e.length,f=t.items,l=K(t.effect.first),d,u=null,p,h=[],v=[],k,y,s,c;if(n)for(c=0;c<o;c+=1)k=e[c],y=i(k,c),s=f.get(y).e,(s.f&T)===0&&((re=(w=s.nodes)==null?void 0:w.a)==null||re.measure(),(p??(p=new Set)).add(s));for(c=0;c<o;c+=1){if(k=e[c],y=i(k,c),s=f.get(y).e,t.outrogroups!==null)for(const I of t.outrogroups)I.pending.delete(s),I.done.delete(s);if((s.f&T)!==0)if(s.f^=T,s===l)U(s,null,r);else{var N=u?u.next:l;s===t.effect.last&&(t.effect.last=s.prev),s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),L(t,u,s),L(t,s,N),U(s,N,r),u=s,h=[],v=[],l=K(u.next);continue}if((s.f&de)!==0&&(ze(s),n&&((be=(ae=s.nodes)==null?void 0:ae.a)==null||be.unfix(),(p??(p=new Set)).delete(s))),s!==l){if(d!==void 0&&d.has(s)){if(h.length<v.length){var P=v[0],g;u=P.prev;var m=h[0],C=h[h.length-1];for(g=0;g<h.length;g+=1)U(h[g],P,r);for(g=0;g<v.length;g+=1)d.delete(v[g]);L(t,m.prev,C.next),L(t,u,m),L(t,C,P),l=P,u=C,c-=1,h=[],v=[]}else d.delete(s),U(s,l,r),L(t,s.prev,s.next),L(t,s,u===null?t.effect.first:u.next),L(t,u,s),u=s;continue}for(h=[],v=[];l!==null&&l!==s;)(d??(d=new Set)).add(l),v.push(l),l=K(l.next);if(l===null)continue}(s.f&T)===0&&h.push(s),u=s,l=K(s.next)}if(t.outrogroups!==null){for(const I of t.outrogroups)I.pending.size===0&&(pe(ye(I.done)),(we=t.outrogroups)==null||we.delete(I));t.outrogroups.size===0&&(t.outrogroups=null)}if(l!==null||d!==void 0){var b=[];if(d!==void 0)for(s of d)(s.f&de)===0&&b.push(s);for(;l!==null;)(l.f&de)===0&&l!==t.fallback&&b.push(l),l=K(l.next);var R=b.length;if(R>0){var q=(a&Ve)!==0&&o===0?r:null;if(n){for(c=0;c<R;c+=1)(ke=(Se=b[c].nodes)==null?void 0:Se.a)==null||ke.measure();for(c=0;c<R;c+=1)(Ee=(Ce=b[c].nodes)==null?void 0:Ce.a)==null||Ee.fix()}Et(t,b,q)}}n&&Be(()=>{var I,Ie;if(p!==void 0)for(s of p)(Ie=(I=s.nodes)==null?void 0:I.a)==null||Ie.apply()})}function Ht(t,e,r,a,i,n,o,f){var l=(o&nt)!==0?(o&ot)===0?lt(r,!1,!1):Ne(r):null,d=(o&ut)!==0?Ne(i):null;return{v:l,i:d,e:ge(()=>(n(e,l??r,d??i,f),()=>{t.delete(a)}))}}function U(t,e,r){if(t.nodes)for(var a=t.nodes.start,i=t.nodes.end,n=e&&(e.f&T)===0?e.nodes.start:r;a!==null;){var o=ht(a);if(n.before(a),a===i)return;a=o}}function L(t,e,r){e===null?t.effect.first=r:e.next=r,r===null?t.effect.last=e:r.prev=e}function Ge(t){var e,r,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var i=t.length;for(e=0;e<i;e++)t[e]&&(r=Ge(t[e]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r);return a}function At(){for(var t,e,r=0,a="",i=arguments.length;r<i;r++)(t=arguments[r])&&(e=Ge(t))&&(a&&(a+=" "),a+=e);return a}function sr(t){return typeof t=="object"?At(t):t??""}function Tt(t,e,r){var a=t==null?"":""+t;return a===""?null:a}function ir(t,e){return t==null?null:String(t)}function J(t,e,r,a,i,n){var o=t.__className;if(S||o!==r||o===void 0){var f=Tt(r);(!S||f!==t.getAttribute("class"))&&(f==null?t.removeAttribute("class"):e?t.className=f:t.setAttribute("class",f)),t.__className=r}return n}function Nt(t,e,r=!1){if(t.multiple){if(e==null)return;if(!qe(e))return _t();for(var a of t.options)a.selected=e.includes(Oe(a));return}for(a of t.options){var i=Oe(a);if(pt(i,e)){a.selected=!0;return}}(!r||e!==void 0)&&(t.selectedIndex=-1)}function nr(t){var e=new MutationObserver(()=>{Nt(t,t.__value)});e.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),gt(()=>{e.disconnect()})}function Oe(t){return"__value"in t?t.__value:t.value}const Pt=Symbol("is custom element"),Mt=Symbol("is html");function or(t){if(S){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var a=t.value;xe(t,"value",null),t.value=a}if(t.hasAttribute("checked")){var i=t.checked;xe(t,"checked",null),t.checked=i}}};t.__on_r=r,Be(r),yt()}}function lr(t,e){var r=me(t);r.value===(r.value=e??void 0)||t.value===e&&(e!==0||t.nodeName!=="PROGRESS")||(t.value=e??"")}function ur(t,e){var r=me(t);r.checked!==(r.checked=e??void 0)&&(t.checked=e)}function xe(t,e,r,a){var i=me(t);S&&(i[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||i[e]!==(i[e]=r)&&(e==="loading"&&(t[mt]=r),r==null?t.removeAttribute(e):typeof r!="string"&&Ft(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function me(t){return t.__attributes??(t.__attributes={[Pt]:t.nodeName.includes("-"),[Mt]:t.namespaceURI===bt})}var Re=new Map;function Ft(t){var e=t.getAttribute("is")||t.nodeName,r=Re.get(e);if(r)return r;Re.set(e,r=[]);for(var a,i=t,n=Element.prototype;n!==i;){a=St(i);for(var o in a)a[o].set&&r.push(o);i=wt(i)}return r}function fr(t,e,r=e){var a=new WeakSet;Ke(t,"input",async i=>{var n=i?t.defaultValue:t.value;if(n=he(t)?ve(n):n,r(n),z!==null&&a.add(z),await kt(),n!==(n=e())){var o=t.selectionStart,f=t.selectionEnd,l=t.value.length;if(t.value=n??"",f!==null){var d=t.value.length;o===f&&f===l&&d>l?(t.selectionStart=d,t.selectionEnd=d):(t.selectionStart=o,t.selectionEnd=Math.min(f,d))}}}),(S&&t.defaultValue!==t.value||Ue(e)==null&&t.value)&&(r(he(t)?ve(t.value):t.value),z!==null&&a.add(z)),Je(()=>{var i=e();if(t===document.activeElement){var n=Ct??z;if(a.has(n))return}he(t)&&i===ve(t.value)||t.type==="date"&&!i&&!t.value||i!==t.value&&(t.value=i??"")})}function cr(t,e,r=e){Ke(t,"change",a=>{var i=a?t.defaultChecked:t.checked;r(i)}),(S&&t.defaultChecked!==t.checked||Ue(e)==null)&&r(t.checked),Je(()=>{var a=e();t.checked=!!a})}function he(t){var e=t.type;return e==="number"||e==="range"}function ve(t){return t===""?null:+t}function te(){return localStorage.getItem("mahoraga_backend_url")||"/agent"}function Lt(){var t,e;return((t=localStorage.getItem("mahoraga_api_token"))==null?void 0:t.trim())||((e=window.VITE_MAHORAGA_API_TOKEN)==null?void 0:e.trim())||""}function le(t,e={}){const r=Lt(),a=new Headers(e.headers);return r&&a.set("Authorization",`Bearer ${r}`),!a.has("Content-Type")&&e.body&&a.set("Content-Type","application/json"),fetch(t,{...e,headers:a})}async function Ot(t){try{const r=await(await le(t)).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Request failed"}}catch{return{data:null,error:"Connection failed"}}}async function xt(){try{const e=await(await le(`${te()}/status`)).json();return e.ok?{data:e.data,error:null}:{data:null,error:e.error||"Failed to fetch status"}}catch{return{data:null,error:"Connection failed - is the agent running?"}}}async function Rt(){try{const e=await(await le(`${te()}/setup/status`)).json();return e.ok?{data:e.data,error:null}:{data:null,error:e.error||"Failed to check setup"}}catch{return{data:null,error:"Connection failed"}}}async function Dt(t){try{const r=await(await le(`${te()}/config`,{method:"POST",body:JSON.stringify(t)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save config"}}catch{return{data:null,error:"Connection failed"}}}async function dr(t){try{const r=await(await fetch(`${te()}/setup/keys`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})).json();return r.ok?{data:r.data,error:null}:{data:null,error:r.error||"Failed to save configuration"}}catch{return{data:null,error:"Failed to connect to agent"}}}async function qt(t=1e3){return Ot(`${te()}/logs?limit=${t}`)}function zt(t,e=24){const r=[],a=Date.now(),i=36e5;let n=t*.95;for(let o=e;o>=0;o--){const f=(Math.random()-.45)*t*.005;n=Math.max(n+f,t*.8);const l=n-t*.95;r.push({timestamp:a-o*i,equity:n,pl:l,pl_pct:l/(t*.95)*100})}return r[r.length-1]={timestamp:a,equity:t,pl:t-r[0].equity,pl_pct:(t-r[0].equity)/r[0].equity*100},r}function jt(t,e,r=20){const a=[],i=e>=0,n=t*(i?.95:1.05);for(let o=0;o<r;o++){const f=o/(r-1),l=n+(t-n)*f,d=l*(Math.random()-.5)*.02;a.push(l+d)}return a[a.length-1]=t,a}const De=["cyan","purple","yellow","blue","green"];var G,Y,Q,W,X,Z,$,ee;class Vt{constructor(){H(this,G,M(null));H(this,Y,M(null));H(this,Q,M(!1));H(this,W,M(!1));H(this,X,M(ie(new Date)));H(this,Z,M(ie([])));H(this,$,M(ie([])));H(this,ee,M(ie({})));B(this,"pollInterval",null);B(this,"timeInterval",null);B(this,"priceHistoryCache",{});B(this,"priceHistoryCacheKey","")}get status(){return E(_(this,G))}set status(e){F(_(this,G),e,!0)}get error(){return E(_(this,Y))}set error(e){F(_(this,Y),e,!0)}get showSetup(){return E(_(this,Q))}set showSetup(e){F(_(this,Q),e,!0)}get setupChecked(){return E(_(this,W))}set setupChecked(e){F(_(this,W),e,!0)}get time(){return E(_(this,X))}set time(e){F(_(this,X),e,!0)}get portfolioHistory(){return E(_(this,Z))}set portfolioHistory(e){F(_(this,Z),e,!0)}get fullLogs(){return E(_(this,$))}set fullLogs(e){F(_(this,$),e,!0)}get logFilters(){return E(_(this,ee))}set logFilters(e){F(_(this,ee),e,!0)}get account(){var e;return((e=this.status)==null?void 0:e.account)??null}get positions(){var e;return((e=this.status)==null?void 0:e.positions)??[]}get signals(){var e;return((e=this.status)==null?void 0:e.signals)??[]}get logs(){var e;return((e=this.status)==null?void 0:e.logs)??[]}get costs(){var e;return((e=this.status)==null?void 0:e.costs)??{total_usd:0,calls:0,tokens_in:0,tokens_out:0}}get config(){var e;return((e=this.status)==null?void 0:e.config)??null}get isMarketOpen(){var e,r,a;return(e=this.config)!=null&&e.crypto_enabled?!0:((a=(r=this.status)==null?void 0:r.clock)==null?void 0:a.is_open)??!1}get startingEquity(){var e;return((e=this.config)==null?void 0:e.starting_equity)||1e5}get unrealizedPl(){return this.positions.reduce((e,r)=>e+r.unrealized_pl,0)}get totalPl(){return this.account?this.account.equity-this.startingEquity:0}get realizedPl(){return this.totalPl-this.unrealizedPl}get totalPlPct(){return this.account?this.totalPl/this.startingEquity*100:0}get portfolioChartData(){return this.portfolioHistory.map(e=>e.equity)}get portfolioChartLabels(){return this.portfolioHistory.map(e=>new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}))}get positionPriceHistories(){const e=this.positions.map(r=>r.symbol).join(",");if(this.priceHistoryCacheKey!==e){const r={};for(const a of this.positions)r[a.symbol]=jt(a.current_price,a.unrealized_pl);this.priceHistoryCache=r,this.priceHistoryCacheKey=e}return this.priceHistoryCache}get normalizedPositionSeries(){return this.positions.slice(0,5).map((e,r)=>{const a=this.positionPriceHistories[e.symbol]||[];if(a.length<2)return null;const i=a[0],n=a.map(o=>(o-i)/i*100);return{label:e.symbol,data:n,variant:De[r%De.length]}}).filter(e=>e!==null)}get filteredLogs(){return this.fullLogs.filter(e=>{var r;return!(this.logFilters.agent&&e.agent!==this.logFilters.agent||this.logFilters.action&&e.action!==this.logFilters.action||this.logFilters.symbol&&!((r=e.symbol)!=null&&r.toLowerCase().includes(this.logFilters.symbol.toLowerCase())))})}async checkSetup(){const{data:e}=await Rt();e&&!e.configured&&(this.showSetup=!0),this.setupChecked=!0}async poll(){const{data:e,error:r}=await xt();e?(this.status=e,this.error=null,this.updatePortfolioHistory(e)):r&&(this.error=r)}async fetchFullLogs(e=1e3){const{data:r}=await qt(e);r&&(this.fullLogs=r.logs)}updatePortfolioHistory(e){var i;if(!e.account)return;if(this.portfolioHistory.length===0){this.portfolioHistory=zt(e.account.equity);return}const a={timestamp:Date.now(),equity:e.account.equity,pl:e.account.equity-(((i=this.portfolioHistory[0])==null?void 0:i.equity)||e.account.equity),pl_pct:this.portfolioHistory[0]?(e.account.equity-this.portfolioHistory[0].equity)/this.portfolioHistory[0].equity*100:0};this.portfolioHistory=[...this.portfolioHistory,a].slice(-48)}startPolling(){this.pollInterval||(this.poll(),this.pollInterval=setInterval(()=>this.poll(),5e3),this.timeInterval=setInterval(()=>this.time=new Date,1e3))}stopPolling(){this.pollInterval&&clearInterval(this.pollInterval),this.timeInterval&&clearInterval(this.timeInterval),this.pollInterval=null,this.timeInterval=null}async handleSaveConfig(e){const{data:r}=await Dt(e);r&&this.status&&(this.status={...this.status,config:r})}completeSetup(){this.showSetup=!1}}G=new WeakMap,Y=new WeakMap,Q=new WeakMap,W=new WeakMap,X=new WeakMap,Z=new WeakMap,$=new WeakMap,ee=new WeakMap;const hr=new Vt;var Bt=D("<div></div>"),Kt=D('<span class="hud-label"> </span>'),Ut=D('<div><div class="relative"><div></div> <!></div> <!></div>');function vr(t,e){const r={active:"bg-hud-success",warning:"bg-hud-warning",error:"bg-hud-error",inactive:"bg-hud-dim"};let a=oe(e,"pulse",3,!1),i=oe(e,"class",3,"");var n=Ut(),o=O(n),f=O(o),l=ne(f,2);{var d=h=>{var v=Bt();V(()=>J(v,1,`absolute inset-0 w-2 h-2 rounded-full animate-ping ${r[e.status]??""} opacity-75`)),A(h,v)};j(l,h=>{a()&&e.status==="active"&&h(d)})}x(o);var u=ne(o,2);{var p=h=>{var v=Kt(),k=O(v,!0);x(v),V(()=>_e(k,e.label)),A(h,v)};j(u,h=>{e.label&&h(p)})}x(n),V(()=>{J(n,1,`flex items-center gap-2 ${i()??""}`),J(f,1,`w-2 h-2 rounded-full ${r[e.status]??""}`)}),A(t,n)}var Jt=D('<span class="hud-label truncate"> </span>'),Gt=D('<span class="hud-value-sm shrink-0"> </span>'),Yt=D('<div class="flex justify-between items-center px-3 sm:px-4 py-2 border-b border-hud-line shrink-0 gap-2"><!> <!></div>'),Qt=D("<div><!> <div><!></div></div>");function gr(t,e){let r=oe(e,"class",3,""),a=oe(e,"noPadding",3,!1);var i=Qt(),n=O(i);{var o=d=>{var u=Yt(),p=O(u);{var h=y=>{var s=Jt(),c=O(s,!0);x(s),V(()=>_e(c,e.title)),A(y,s)};j(p,y=>{e.title&&y(h)})}var v=ne(p,2);{var k=y=>{var s=Me(),c=Pe(s);{var N=g=>{var m=Gt(),C=O(m,!0);x(m),V(()=>_e(C,e.titleRight)),A(g,m)},P=g=>{var m=Me(),C=Pe(m);Fe(C,()=>e.titleRight),A(g,m)};j(c,g=>{typeof e.titleRight=="string"?g(N):g(P,!1)})}A(y,s)};j(v,y=>{e.titleRight&&y(k)})}x(u),A(d,u)};j(n,d=>{(e.title||e.titleRight)&&d(o)})}var f=ne(n,2),l=O(f);Fe(l,()=>e.children),x(f),x(i),V(()=>{J(i,1,`hud-panel flex flex-col ${r()??""}`),J(f,1,`flex-1 min-h-0 ${a()?"":"p-2.5 sm:p-3"}`)}),A(t,i)}export{gr as P,vr as S,lr as a,fr as b,nr as c,hr as d,ar as e,Nt as f,ur as g,sr as h,rr as i,xe as j,cr as k,dr as l,or as r,J as s,ir as t};
